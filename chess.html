<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>משחק שחמט מקצועי - נגד שחקן או בוט</title>

<!-- chessboardjs -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard.min.css" />
<script src="https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/dist/chessboard.min.js"></script>

<!-- chess.js -->
<script src="https://cdn.jsdelivr.net/npm/chess.js@1.0.0/chess.min.js"></script>

<style>
  /* פונטים */
  @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@400;600&display=swap');

  * {
    box-sizing: border-box;
  }
  body {
    margin: 0; padding: 0;
    font-family: 'Heebo', sans-serif;
    background: linear-gradient(135deg, #1f1c2c, #928dab);
    color: #eee;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  h1 {
    font-weight: 600;
    font-size: 2.4rem;
    margin-bottom: 12px;
    text-align: center;
    letter-spacing: 0.05em;
    user-select: none;
  }

  .controls {
    width: 100%;
    max-width: 480px;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 12px;
    margin-bottom: 20px;
    user-select: none;
  }

  label {
    font-weight: 600;
    font-size: 1rem;
    align-self: center;
  }

  select, button {
    font-size: 1rem;
    padding: 12px 18px;
    border-radius: 14px;
    border: none;
    outline: none;
    cursor: pointer;
    transition: background-color 0.25s ease, box-shadow 0.25s ease;
    font-weight: 600;
    user-select: none;
  }
  select {
    min-width: 150px;
    background: #3c3a59;
    color: #eee;
  }
  select:focus {
    box-shadow: 0 0 10px #7b68eeaa;
  }
  button {
    background: #7b68ee;
    color: white;
    box-shadow: 0 6px 12px #6a54d4bb;
  }
  button:hover:not(:disabled) {
    background: #5a43cc;
    box-shadow: 0 8px 20px #5a43cccc;
  }
  button:active:not(:disabled) {
    transform: translateY(2px);
  }
  button:disabled {
    background: #666;
    cursor: not-allowed;
    box-shadow: none;
  }

  /* לוח שחמט */
  #board {
    width: 480px;
    max-width: 90vw;
    margin: 0 auto;
    border-radius: 18px;
    box-shadow:
      0 6px 15px rgba(0,0,0,0.5),
      inset 0 0 20px rgba(123,104,238,0.5);
    animation: fadeIn 0.8s ease;
  }

  /* הודעות סטטוס */
  #status {
    margin-top: 16px;
    min-height: 30px;
    font-size: 1.25rem;
    font-weight: 700;
    text-align: center;
    user-select: none;
    padding: 8px 12px;
    border-radius: 12px;
    transition: background-color 0.4s ease;
  }
  #status.turn-white {
    background-color: #6a87ff88;
    color: #fff;
  }
  #status.turn-black {
    background-color: #444466bb;
    color: #ddd;
  }
  #status.check {
    background-color: #f76c6ccc;
    color: white;
    text-shadow: 0 0 8px #ff4949bb;
  }
  #status.checkmate {
    background-color: #e82c2ccc;
    color: white;
    text-shadow: 0 0 12px #ff0000cc;
    font-size: 1.5rem;
  }
  #status.draw {
    background-color: #bbbbaa99;
    color: #333;
  }

  /* קישור חזרה */
  #backHome {
    margin-top: auto;
    margin-bottom: 12px;
    font-weight: 600;
    font-size: 1rem;
    text-decoration: none;
    color: #ccc;
    transition: color 0.3s ease;
    user-select: none;
  }
  #backHome:hover {
    color: #7b68ee;
  }

  /* אנימציה כניסה */
  @keyframes fadeIn {
    0% {opacity: 0; transform: translateY(12px);}
    100% {opacity: 1; transform: translateY(0);}
  }

  /* מדיה מובייל */
  @media (max-width: 480px) {
    h1 {
      font-size: 1.8rem;
    }
    .controls {
      flex-direction: column;
      max-width: 320px;
      gap: 14px;
    }
    select, button {
      min-width: 100%;
      font-size: 1.1rem;
      padding: 14px 20px;
    }
    #board {
      width: 90vw;
      height: 90vw;
    }
    #status {
      font-size: 1.2rem;
      padding: 12px 16px;
    }
  }
</style>
</head>
<body>

<h1>משחק שחמט מקצועי</h1>

<div class="controls" role="region" aria-label="בחירת מצב המשחק והגדרות">
  <label for="modeSelect">מצב משחק:</label>
  <select id="modeSelect" aria-describedby="modeDesc">
    <option value="human">שחק נגד שחקן</option>
    <option value="bot">שחק נגד בוט</option>
  </select>

  <label for="difficultySelect" id="diffLabel" style="display:none;">רמת קושי:</label>
  <select id="difficultySelect" style="display:none;" aria-describedby="diffDesc">
    <option value="easy">קל</option>
    <option value="medium">בינוני</option>
    <option value="hard">קשה</option>
  </select>

  <button id="restartBtn" aria-label="התחל משחק חדש">התחל משחק חדש</button>
</div>

<div id="board"></div>

<div id="status" role="status" aria-live="polite"></div>

<a href="https://shalev1912.github.io/chat-gpt/home.html" id="backHome" role="link" aria-label="חזרה למסך הבית">← חזרה למסך הבית</a>

<script>
  const modeSelect = document.getElementById('modeSelect');
  const difficultySelect = document.getElementById('difficultySelect');
  const diffLabel = document.getElementById('diffLabel');
  const restartBtn = document.getElementById('restartBtn');
  const statusEl = document.getElementById('status');

  let board = null;
  let game = new Chess();

  let currentMode = 'human';
  let botDifficulty = 'easy';

  // הצגת הודעה ומחלקת סטטוס
  function setStatus(message, className = '') {
    statusEl.textContent = message;
    statusEl.className = '';
    if (className) statusEl.classList.add(className);
  }

  // עדכון מצב המשחק עם צבעים ואפקטים
  function updateStatus() {
    if (game.in_checkmate()) {
      setStatus('מט! המשחק נגמר.', 'checkmate');
    } else if (game.in_draw()) {
      setStatus('תיקו!', 'draw');
    } else {
      let turn = game.turn() === 'w' ? 'לבן' : 'שחור';
      if (game.in_check()) {
        setStatus(`תור ${turn} - שח למלך!`, 'check');
      } else {
        setStatus(`תור ${turn}`, game.turn() === 'w' ? 'turn-white' : 'turn-black');
      }
    }
  }

  // התחלת הלוח עם אפשרות להזיז חתיכות
  function onDragStart(source, piece, position, orientation) {
    if (game.game_over()) return false;

    if (currentMode === 'bot') {
      // שחקן שולט רק בלבן
      if ((game.turn() === 'w' && piece.search(/^b/) !== -1) ||
          (game.turn() === 'b' && piece.search(/^w/) !== -1)) {
        return false;
      }
    }
    // לא מאפשרים להזיז חתיכה שלא שייכת לתור
    if (game.turn() === 'w' && piece.search(/^b/) !== -1) return false;
    if (game.turn() === 'b' && piece.search(/^w/) !== -1) return false;

    return true;
  }

  // מהלך שנעשה על ידי השחקן
  function onDrop(source, target) {
    let move = game.move({
      from: source,
      to: target,
      promotion: 'q'
    });

    if (move === null) return 'snapback';

    updateStatus();

    if (currentMode === 'bot' && !game.game_over()) {
      window.setTimeout(makeBotMove, 500);
    }
  }

  function onSnapEnd() {
    board.position(game.fen());
  }

  // רמות קושי לבוט
  function makeBotMove() {
    if (game.game_over()) return;

    let possibleMoves = game.moves();
    if (possibleMoves.length === 0) return;

    let move = null;

    if (botDifficulty === 'easy') {
      const randomIndex = Math.floor(Math.random() * possibleMoves.length);
      move = possibleMoves[randomIndex];
    } else if (botDifficulty === 'medium') {
      // בוחרים מתוך 3 מהלכים אקראיים
      const top3 = possibleMoves.slice(0, 3);
      const randomIndex = Math.floor(Math.random() * top3.length);
      move = top3[randomIndex];
    } else {
      // קשה - הערכה פשוטה לפי חומר
      let bestMove = null;
      let bestScore = -Infinity;
      for (let m of possibleMoves) {
        game.move(m);
        let score = evaluateBoard(game);
        game.undo();
        if (score > bestScore) {
          bestScore = score;
          bestMove = m;
        }
      }
      move = bestMove;
    }

    game.move(move);
    board.position(game.fen());
    updateStatus();
  }

  // פונקציית הערכה בסיסית לפי חומר
  function evaluateBoard(gameInstance) {
    const values = { p:1, n:3, b:3, r:5, q:9, k:0 };
    let score = 0;
    let fen = gameInstance.fen();
    for (let char of fen) {
      if (char === ' ') break;
      let lower = char.toLowerCase();
      if (values[lower]) {
        if (char === lower) score -= values[lower]; // שחורות
        else score += values[lower]; // לבנות
      }
    }
    return score;
  }

  // התחלת לוח
  function init() {
    board = Chessboard('board', {
      draggable: true,
      position: 'start',
      onDragStart: onDragStart,
      onDrop: onDrop,
      onSnapEnd: onSnapEnd,
      pieceTheme: 'https://cdn.jsdelivr.net/npm/chessboardjs@1.0.0/img/chesspieces/wikipedia/{piece}.png',
      responsive: true
    });
    updateStatus();
  }

  // שינוי מצב משחק - הצגת רמת קושי רק בבוט
  modeSelect.addEventListener('change', () => {
    currentMode = modeSelect.value;
    if (currentMode === 'bot') {
      difficultySelect.style.display = 'inline-block';
      diffLabel.style.display = 'inline-block';
    } else {
      difficultySelect.style.display = 'none';
      diffLabel.style.display = 'none';
    }
    resetGame();
  });

  difficultySelect.addEventListener('change', () => {
    botDifficulty = difficultySelect.value;
  });

  restartBtn.addEventListener('click', resetGame);

  // איפוס משחק
  function resetGame() {
    game.reset();
    board.start();
    updateStatus();
  }

  window.onload = () => {
    init();
  };
</script>

</body>
</html>