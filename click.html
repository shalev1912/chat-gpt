<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>×œ×—×¥ ×•×¦×‘×•×¨ â€” EXP & ×—× ×•×ª</title>
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0f1724; --accent:#7CFFEA; --accent2:#6A6CFF; --glass: rgba(255,255,255,0.04);
    --neon: rgba(124,255,234,0.12);
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; font-family: 'Rubik', system-ui, -apple-system, Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 10% 10%, #071019 0%, #081227 20%, #071330 60%, #04060b 100%);
    color:#E6F3F1; display:flex; align-items:center; justify-content:center; padding:28px;
  }

  .app {
    width:100%; max-width:980px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:16px; padding:22px; box-shadow: 0 10px 40px rgba(2,8,23,0.7);
    border: 1px solid rgba(124,255,234,0.06); position:relative; overflow:hidden;
  }

  header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  .brand { display:flex; gap:12px; align-items:center; }
  .logo { width:56px; height:56px; border-radius:12px; background:linear-gradient(135deg,var(--accent),var(--accent2)); display:flex; align-items:center; justify-content:center; color:#021; font-weight:800; box-shadow: 0 6px 20px rgba(106,108,255,0.14); }
  h1{font-size:20px;margin:0}
  p.lead{ margin:0;color:rgba(230,243,241,0.85); font-size:13px }

  .controls { display:flex; gap:10px; align-items:center; }
  .btn {
    background: linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color:var(--accent); border:1px solid rgba(124,255,234,0.08); padding:8px 12px; border-radius:10px; cursor:pointer;
    font-weight:600;
  }
  .btn.primary{
    background: linear-gradient(90deg,var(--accent),var(--accent2));
    color:#021; border: none; box-shadow: 0 10px 30px rgba(106,108,255,0.12);
  }
  .btn:disabled{ opacity:0.45; cursor:not-allowed; }

  main { display:flex; gap:20px; align-items:flex-start; }
  .left { flex:1; display:flex; flex-direction:column; align-items:center; gap:12px; }
  .right { width:360px; background:rgba(255,255,255,0.02); border-radius:12px; padding:14px; }

  #click-btn{
    font-size:20px; padding:24px 40px; border-radius:14px; cursor:pointer; border:none;
    background: linear-gradient(90deg,var(--accent2),var(--accent));
    color:#021; font-weight:800; box-shadow: 0 12px 40px rgba(106,108,255,0.14);
  }

  .stat{ background:var(--glass); padding:10px 14px; border-radius:10px; width:100%; display:flex; justify-content:space-between; align-items:center; border:1px solid rgba(255,255,255,0.02); }
  .stat small{ color:rgba(230,243,241,0.7) }

  /* EXP bar */
  .exp-wrap{ width:100%; margin-top:6px; }
  .exp-bg{ height:18px; background:rgba(255,255,255,0.03); border-radius:12px; overflow:hidden; border:1px solid rgba(124,255,234,0.04) }
  .exp-bar{ height:100%; width:0%; background: linear-gradient(90deg,#ffdd57,#ffaa00); transition: width 0.25s ease; box-shadow: inset 0 -6px 18px rgba(0,0,0,0.2); }

  .currency{ display:flex; gap:10px; margin-top:8px; align-items:center; }
  .coin{ background:linear-gradient(90deg,#ffd166,#ffb347); color:#111; padding:6px 10px; border-radius:8px; font-weight:700; box-shadow:0 6px 18px rgba(255,177,71,0.12) }

  /* shop modal */
  .modal-backdrop { position:fixed; inset:0; background:rgba(2,6,23,0.7); display:flex; align-items:center; justify-content:center; z-index:60; }
  .modal { width:92%; max-width:760px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:18px; border:1px solid rgba(124,255,234,0.06); box-shadow:0 30px 80px rgba(2,8,23,0.7); }
  .modal h3{ margin:0 0 8px 0; font-size:18px }
  .shop-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; margin-top:12px }
  .shop-item{ background:rgba(255,255,255,0.02); padding:12px; border-radius:10px; display:flex; flex-direction:column; gap:8px; border:1px solid rgba(255,255,255,0.02) }
  .shop-item h4{ margin:0; font-size:16px }
  .shop-item small{ color:rgba(230,243,241,0.7) }
  .shop-item .buy-row{ display:flex; justify-content:space-between; align-items:center; gap:8px; margin-top:6px }
  .shop-item .count{ font-weight:700; color:var(--accent) }

  /* small helper */
  .muted{ color:rgba(230,243,241,0.65); font-size:13px }
  footer{ margin-top:14px; text-align:center; color:rgba(230,243,241,0.5); font-size:13px }

  /* particles canvas */
  #particle-canvas{ position:absolute; inset:0; pointer-events:none; z-index:30 }

  @media (max-width:860px){
    main{ flex-direction:column; align-items:stretch }
    .right{ width:100% }
    .shop-grid{ grid-template-columns: 1fr }
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="××©×—×§ EXP ×¢× ×—× ×•×ª">
    <canvas id="particle-canvas"></canvas>

    <header>
      <div class="brand">
        <div class="logo">EXP</div>
        <div>
          <h1>×œ×—×¥ ×•×¦×‘×•×¨ - ×—× ×•×ª ××•×˜×•××˜×™×ª</h1>
          <p class="lead">×¦×‘×•×¨ EXP, ×§× ×” ×—× ×•×™×•×ª ×©×™×™×¦×¨×• EXP ×œ×›×œ ×©× ×™×™×” ×•×©×“×¨×’ ××ª ×”×œ×—×™×¦×”</p>
        </div>
      </div>

      <div class="controls" aria-hidden="false">
        <button id="shop-btn" class="btn">ğŸ›’ ×—× ×•×ª</button>
        <button id="reset-btn" class="btn">â™» ××™×¤×•×¡</button>
        <a class="btn" href="https://shalev1912.github.io/chat-gpt/home.html" target="_blank" rel="noopener">ğŸ  ×—×–×¨×” ×œ××ª×¨</a>
      </div>
    </header>

    <main>
      <section class="left">
        <div class="stat" style="max-width:520px">
          <div>
            <div style="font-size:13px; color:rgba(230,243,241,0.8)">× ×§×•×“×•×ª EXP</div>
            <div style="font-weight:800; font-size:20px" id="exp-display">0</div>
            <div class="exp-wrap">
              <div class="exp-bg" aria-hidden="true">
                <div id="exp-bar" class="exp-bar"></div>
              </div>
              <div style="display:flex;justify-content:space-between;margin-top:6px">
                <small class="muted">EXP ×¢×“ ×“×•×œ×¨ ×”×‘×</small>
                <small id="to-next" class="muted">100</small>
              </div>
            </div>
          </div>
        </div>

        <button id="click-btn" aria-label="×œ×—×¥ ×œ×§×‘×œ×ª EXP">×œ×—×¥ ×œ×§×‘×œ×ª EXP</button>

        <div style="display:flex; gap:10px; margin-top:10px; width:100%; justify-content:center; align-items:center;">
          <div class="coin">×“×•×œ×¨×™×: <span id="dollars">0</span></div>
          <div class="coin">EXP/×œ×—×™×¦×”: <span id="click-value">1</span></div>
          <div class="coin">EXP/×©× ×™×”: <span id="pps">0</span></div>
        </div>
      </section>

      <aside class="right">
        <div style="display:flex;flex-direction:column; gap:8px;">
          <div class="stat"><small>×©×“×¨×•×’ ×œ×—×™×¦×”</small><div style="display:flex;gap:8px;align-items:center">
            <div style="font-weight:800" id="upgrade-level">Lv.0</div>
            <div class="muted" style="font-size:13px" id="upgrade-desc">+1 EXP ×œ×œ×—×™×¦×”</div>
          </div></div>

          <div style="display:flex; gap:8px; align-items:center;">
            <button id="buy-upgrade" class="btn primary">×§× ×” ×©×“×¨×•×’</button>
            <div class="muted">××—×™×¨: <span id="upgrade-cost">10</span> ×“×•×œ×¨×™×</div>
          </div>

          <div style="height:1px;background:rgba(255,255,255,0.03);margin:8px 0;border-radius:2px"></div>

          <div class="muted">×˜×™×¤×™×: ×§× ×” ×¤×¨×™×˜×™× ×©××™×™×¦×¨×™× EXP ××•×˜×•××˜×™×ª. ×©×“×¨×’ ×œ×—×™×¦×” ×œ×”×’×“×œ×ª ×”×›× ×¡×” ××¤×¢×™×œ×”.</div>
        </div>
      </aside>
    </main>

    <footer>×”×›×œ × ×©××¨ ××•×˜×•××˜×™×ª ×‘××›×©×™×¨×š (localStorage). ×¤× ×” ××œ×™ ×× ×ª×¨×¦×” ×—× ×•×ª ××ª×§×“××ª ×™×•×ª×¨ ××• ×—×™×‘×•×¨ ×œ×©×¨×ª.</footer>
  </div>

  <!-- Modal shop (initially hidden) -->
  <div id="shop-modal" class="modal-backdrop hidden" aria-hidden="true" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <div style="display:flex;align-items:center;justify-content:space-between">
        <h3>ğŸ¬ ×”×—× ×•×ª</h3>
        <div>
          <button id="close-shop" class="btn">âœ– ×¡×’×•×¨</button>
        </div>
      </div>

      <div style="margin-top:8px; color:rgba(230,243,241,0.8)">×§× ×” ×—× ×•×™×•×ª ××• ×©×“×¨×•×’×™× ×¤×¡×™×‘×™×™× â€” ×›×œ ×¤×¨×™×˜ ××™×™×¦×¨ EXP ×œ×©× ×™×™×” (××• ×©×“×¨×’ ××ª ×”×œ×—×™×¦×”).</div>

      <div class="shop-grid" id="shop-grid">
        <!-- ×¤×¨×™×˜×™× ×™×™×¦×¨× ×• ×“×™× ××™×ª -->
      </div>
      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button id="buy-selected" class="btn primary">×§× ×”</button>
      </div>
    </div>
  </div>

<script>
/* ====== × ×ª×•× ×™ ×—× ×•×ª ×•××¦×‘ ====== */
const SHOP_ITEMS = [
  { id:'kiosk', name:'×§×™×•×¡×§', desc:'×™×™×¦×•×¨ ×§×˜×Ÿ', cost:5, pps:1 },
  { id:'stall', name:'×¢×’×œ×ª ×¨×—×•×‘', desc:'×™×•××Ÿ ×™×•×ª×¨', cost:25, pps:5 },
  { id:'shop', name:'×—× ×•×ª', desc:'×™×™×¦×•×¨ ×§×‘×•×¢', cost:120, pps:15 },
  { id:'factory', name:'××¤×¢×œ', desc:'×™×™×¦×•×¨ ×ª×¢×©×™×™×ª×™', cost:700, pps:100 },
];

const UPGRADE_BASE_COST = 10;
const UPGRADE_COST_MULT = 1.9; // ×¡×§×œ×™× ×’ ×œ××—×™×¨ ×©×“×¨×•×’×™×

let state = {
  exp: 0,
  dollars: 0,
  clickValue: 1,
  items: {},    // id -> count
  upgradeLevel: 0
};

/* ====== ×©××™×¨×” ×•×˜×¢× ×ª ××¦×‘ ====== */
function saveState(){
  localStorage.setItem('expGameState', JSON.stringify(state));
}
function loadState(){
  const raw = localStorage.getItem('expGameState');
  if(raw){
    try{
      const parsed = JSON.parse(raw);
      state = Object.assign(state, parsed);
    }catch(e){ console.warn('fail load', e); }
  }
}
/* ×˜×¢× ×ª ××¦×‘ ×‘×¨××© */
loadState();

/* ====== UI references ====== */
const expDisplay = document.getElementById('exp-display');
const expBar = document.getElementById('exp-bar');
const toNext = document.getElementById('to-next');
const dollarsEl = document.getElementById('dollars');
const clickValEl = document.getElementById('click-value');
const ppsEl = document.getElementById('pps');
const clickBtn = document.getElementById('click-btn');

const shopBtn = document.getElementById('shop-btn');
const shopModal = document.getElementById('shop-modal');
const closeShopBtn = document.getElementById('close-shop');
const shopGrid = document.getElementById('shop-grid');
const buySelectedBtn = document.getElementById('buy-selected');

const buyUpgradeBtn = document.getElementById('buy-upgrade');
const upgradeLevelEl = document.getElementById('upgrade-level');
const upgradeDescEl = document.getElementById('upgrade-desc');
const upgradeCostEl = document.getElementById('upgrade-cost');

const resetBtn = document.getElementById('reset-btn');

/* ====== ×—×™×©×•×‘×™ PPS ====== */
function computePps(){
  let total = 0;
  for(const it of SHOP_ITEMS){
    const cnt = state.items[it.id] || 0;
    total += cnt * it.pps;
  }
  return total;
}
function toNextDollar(){
  // × ×©××¨ ×¢×“ ×“×•×œ×¨ ×”×‘×: ×ª××™×“ 100 EXP -> 1 ×“×•×œ×¨
  return 100 - state.exp;
}

/* ====== ×¢×“×›×•×Ÿ UI ====== */
function updateUI(){
  expDisplay.textContent = Math.floor(state.exp);
  const pct = Math.min(100, (state.exp / 100) * 100);
  expBar.style.width = pct + '%';
  toNext.textContent = Math.max(0, toNextDollar());
  dollarsEl.textContent = state.dollars;
  clickValEl.textContent = state.clickValue;
  ppsEl.textContent = computePps();

  upgradeLevelEl.textContent = 'Lv.' + state.upgradeLevel;
  upgradeDescEl.textContent = `+${state.upgradeLevel + 1} EXP ×œ×œ×—×™×¦×”`;
  upgradeCostEl.textContent = Math.floor(upgradeCostForNext());

  // shop grid refresh counts and button enabled state
  renderShopGrid();

  saveState();
}

/* ====== ×—× ×•×ª: ×™×¦×™×¨×ª ×›×¨×˜×™×¡×™× ×•×“×™× ××™×§×” ====== */
function renderShopGrid(){
  shopGrid.innerHTML = '';
  for(const it of SHOP_ITEMS){
    const cnt = state.items[it.id] || 0;
    const card = document.createElement('div');
    card.className = 'shop-item';
    card.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h4>${it.name}</h4>
        <div class="count">x${cnt}</div>
      </div>
      <div><small class="muted">${it.desc}</small></div>
      <div class="muted">×™×™×¦×•×¨: <strong>${it.pps}</strong> EXP/×©× ×™×™×”</div>
      <div class="buy-row">
        <div class="muted">××—×™×¨: <strong>${it.cost}</strong> ×“×•×œ×¨×™×</div>
        <button class="btn buy-btn" data-id="${it.id}">×§× ×”</button>
      </div>
    `;
    shopGrid.appendChild(card);
  }
  // ×—×™×‘×•×¨ ×××–×™× ×™× ×œ×›×¤×ª×•×¨×™ ×§× ×™×™×”
  document.querySelectorAll('.buy-btn').forEach(b => {
    b.addEventListener('click', () => {
      const id = b.dataset.id;
      buyItem(id);
    });
  });
}

/* ====== ×§× ×™×™×” / ×©×“×¨×•×’ ====== */
function buyItem(id){
  const it = SHOP_ITEMS.find(x => x.id === id);
  if(!it) return;
  if(state.dollars < it.cost){
    flashMessage('××™×Ÿ ××¡×¤×™×§ ×“×•×œ×¨×™× ×œ×§× ×™×™×”');
    return;
  }
  state.dollars -= it.cost;
  state.items[it.id] = (state.items[it.id] || 0) + 1;
  flashMessage(`× ×›×•×Ÿ ×§× ×™×ª ${it.name}`);
  updateUI();
}
function upgradeCostForNext(){
  return UPGRADE_BASE_COST * Math.pow(UPGRADE_COST_MULT, state.upgradeLevel);
}
buyUpgradeBtn.addEventListener('click', () => {
  const cost = Math.floor(upgradeCostForNext());
  if(state.dollars < cost){
    flashMessage('××™×Ÿ ××¡×¤×™×§ ×“×•×œ×¨×™× ×œ×©×“×¨×•×’');
    return;
  }
  state.dollars -= cost;
  state.upgradeLevel++;
  state.clickValue = 1 + state.upgradeLevel;
  flashMessage(`×©×™×“×¨×’×ª ×œ×—×™×¦×” ×œ Lv.${state.upgradeLevel}`);
  updateUI();
});

/* ====== ×œ×—×™×¦×” ====== */
clickBtn.addEventListener('click', () => {
  state.exp += state.clickValue;
  collectDollars();
  updateUI();
});

/* ====== ×”×›× ×¡×” ××•×˜×•××˜×™×ª ×›×œ ×©× ×™×™×” ====== */
setInterval(() => {
  const pps = computePps();
  if(pps > 0){
    state.exp += pps;
    collectDollars();
    updateUI();
  }
}, 1000);

/* ====== ×”××¨×ª EXP ×œ×“×•×œ×¨×™× ====== */
function collectDollars(){
  while(state.exp >= 100){
    state.exp -= 100;
    state.dollars++;
  }
}

/* ====== ×”×•×“×¢×•×ª ×–×× ×™×•×ª ====== */
function flashMessage(msg){
  // ×œ×¤×©×˜ - ××©×ª××© ×‘×” alert ×‘×™× ×ª×™×™×
  // ××¤×©×¨ ×œ×©×¤×¨ ×œ-toast ×•×¢×•×“
  alert(msg);
}

/* ====== ××™×¤×•×¡ ====== */
resetBtn.addEventListener('click', () => {
  if(confirm('××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××¤×¡ ××ª ×”××©×—×§?')){
    state = {
      exp: 0,
      dollars: 0,
      clickValue: 1,
      items: {},
      upgradeLevel: 0
    };
    updateUI();
  }
});

/* ====== ×”×ª× ×”×’×•×ª ×”×—× ×•×ª ====== */

// ×©×“×¨×•×’ ×”×”×ª× ×”×’×•×ª: ×›×¤×ª×•×¨ ×”×—× ×•×ª ×¢×•×‘×“ ×›-toggle
shopBtn.addEventListener('click', () => {
  const isHidden = shopModal.classList.contains('hidden');
  if(isHidden){
    renderShopGrid();
    shopModal.classList.remove('hidden');
    shopModal.setAttribute('aria-hidden','false');
  } else {
    shopModal.classList.add('hidden');
    shopModal.setAttribute('aria-hidden','true');
  }
});
closeShopBtn.addEventListener('click', () => {
  shopModal.classList.add('hidden');
  shopModal.setAttribute('aria-hidden','true');
});

/* ====== ×”×ª×—×œ×ª UI ====== */
updateUI();

</script>
</body>
</html>
