<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>砖拽 住拽 - 砖 拽</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background: linear-gradient(135deg, #6b73ff 0%, #000dff 100%);
      color: white;
      margin: 0; padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-bottom: 0.2em;
      font-weight: 700;
    }
    #controls {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    select, button {
      font-size: 16px;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    select {
      min-width: 120px;
    }
    button {
      background-color: #4a4a9f;
      color: white;
      min-width: 100px;
    }
    button:hover {
      background-color: #6262c4;
    }
    button#homeBtn {
      background-color: #6c757d;
      min-width: 80px;
      font-size: 18px;
    }
    button#homeBtn:hover {
      background-color: #5a6268;
    }
    #timer {
      font-size: 18px;
      font-weight: 600;
      margin-left: 10px;
      user-select: none;
    }
    table {
      border-collapse: collapse;
      margin-top: 10px;
      user-select: none;
    }
    td {
      border: 1.5px solid #aaa;
      width: 44px;
      height: 44px;
      text-align: center;
      vertical-align: middle;
      font-size: 20px;
      background: rgba(255,255,255,0.1);
      cursor: pointer;
      position: relative;
    }
    /* 注爪 转 拽 3x3 */
    td.block-border-right {
      border-right: 3px solid white;
    }
    td.block-border-bottom {
      border-bottom: 3px solid white;
    }
    td input {
      width: 100%;
      height: 100%;
      font-size: 20px;
      border: none;
      text-align: center;
      background: transparent;
      color: white;
      font-weight: 600;
    }
    td input:focus {
      outline: 2px solid #ffd166;
      background: rgba(255, 255, 255, 0.15);
    }
    /* 转 砖砖转砖   砖转 */
    td.prefilled {
      background: rgba(255, 255, 255, 0.25);
      font-weight: 700;
      cursor: default;
    }
    /* 砖 */
    td.error input {
      background-color: #ff4c4caa;
    }
    /* 注 住 */
    #message {
      margin-top: 15px;
      font-size: 18px;
      font-weight: 700;
      color: #ffd166;
    }
    @media (max-width: 480px) {
      td {
        width: 32px;
        height: 32px;
        font-size: 16px;
      }
      select, button {
        font-size: 14px;
        padding: 6px 10px;
      }
    }
  </style>
</head>
<body>

  <h1>砖拽 住拽</h1>

  <div id="controls" role="region" aria-label="拽专转 砖拽">
    <label for="difficulty" style="user-select:none;">专转 拽砖:</label>
    <select id="difficulty" aria-label="专 专转 拽砖">
      <option value="easy" selected>拽</option>
      <option value="medium"></option>
      <option value="hard">拽砖</option>
    </select>

    <button id="newGameBtn" aria-label="转 砖拽 砖">转 砖拽</button>
    <button id="timerToggle" aria-pressed="false" aria-label="驻注/ 专">驻注 专</button>
    <div id="timer" aria-live="polite" aria-atomic="true">00:00</div>
    <button id="homeBtn" aria-label="专 住 转" title="专 住 转"> 转</button>
  </div>

  <table id="sudoku-grid" role="grid" aria-label=" 住拽" tabindex="0"></table>

  <div id="message" role="alert" aria-live="assertive"></div>

<script>
(() => {
  const easyBoard = [
    [0,0,3, 0,2,0, 6,0,0],
    [9,0,0, 3,0,5, 0,0,1],
    [0,0,1, 8,0,6, 4,0,0],
    [0,0,8, 1,0,2, 9,0,0],
    [7,0,0, 0,0,0, 0,0,8],
    [0,0,6, 7,0,8, 2,0,0],
    [0,0,2, 6,0,9, 5,0,0],
    [8,0,0, 2,0,3, 0,0,9],
    [0,0,5, 0,1,0, 3,0,0]
  ];
  const mediumBoard = [
    [0,2,0, 6,0,8, 0,0,0],
    [5,8,0, 0,0,9, 7,0,0],
    [0,0,0, 0,4,0, 0,0,0],
    [3,7,0, 0,0,0, 5,0,0],
    [6,0,0, 0,0,0, 0,0,4],
    [0,0,8, 0,0,0, 0,1,3],
    [0,0,0, 0,2,0, 0,0,0],
    [0,0,9, 8,0,0, 0,3,6],
    [0,0,0, 3,0,6, 0,9,0]
  ];
  const hardBoard = [
    [0,0,0, 0,0,0, 0,0,0],
    [0,0,0, 0,0,3, 0,8,5],
    [0,0,1, 0,2,0, 0,0,0],
    [0,0,0, 5,0,7, 0,0,0],
    [0,0,4, 0,0,0, 1,0,0],
    [0,9,0, 0,0,0, 0,0,0],
    [5,0,0, 0,0,0, 0,7,3],
    [0,0,2, 0,1,0, 0,0,0],
    [0,0,0, 0,4,0, 0,0,9]
  ];

  const boardElem = document.getElementById('sudoku-grid');
  const difficultySelect = document.getElementById('difficulty');
  const newGameBtn = document.getElementById('newGameBtn');
  const timerToggle = document.getElementById('timerToggle');
  const timerDisplay = document.getElementById('timer');
  const homeBtn = document.getElementById('homeBtn');
  const message = document.getElementById('message');

  let currentBoard = [];
  let solutionBoard = [];
  let timer = null;
  let timerSeconds = 0;
  let timerRunning = false;

  function cloneBoard(board) {
    return board.map(row => [...row]);
  }

  // 驻砖 驻转专  ( 驻) - 砖砖  爪专 
  function solveBoard(board) {
    const findEmpty = (board) => {
      for(let r=0;r<9;r++) {
        for(let c=0;c<9;c++) {
          if(board[r][c] === 0) return [r,c];
        }
      }
      return null;
    };

    const isValid = (board, row, col, num) => {
      for(let i=0;i<9;i++) {
        if(board[row][i] === num) return false;
        if(board[i][col] === num) return false;
      }
      const startRow = Math.floor(row/3)*3;
      const startCol = Math.floor(col/3)*3;
      for(let r=0;r<3;r++) {
        for(let c=0;c<3;c++) {
          if(board[startRow+r][startCol+c] === num) return false;
        }
      }
      return true;
    };

    const backtrack = () => {
      const emptyPos = findEmpty(board);
      if(!emptyPos) return true;
      const [r,c] = emptyPos;
      for(let num=1;num<=9;num++) {
        if(isValid(board,r,c,num)){
          board[r][c] = num;
          if(backtrack()) return true;
          board[r][c] = 0;
        }
      }
      return false;
    };

    backtrack();
  }

  //  转  转 注专
  function drawBoard() {
    boardElem.innerHTML = '';
    for(let r=0; r<9; r++) {
      const tr = document.createElement('tr');
      for(let c=0; c<9; c++) {
        const td = document.createElement('td');
        // 转 拽 3x3
        if(c === 2 || c === 5) td.classList.add('block-border-right');
        if(r === 2 || r === 5) td.classList.add('block-border-bottom');

        if(currentBoard[r][c] !== 0) {
          td.textContent = currentBoard[r][c];
          td.classList.add('prefilled');
          td.setAttribute('aria-label', `转 砖 转 住驻专 ${currentBoard[r][c]}`);
        } else {
          const input = document.createElement('input');
          input.type = 'text';
          input.maxLength = 1;
          input.setAttribute('inputmode', 'numeric');
          input.setAttribute('aria-label', `转 专拽 砖专 ${r+1}, 注 ${c+1}`);
          input.addEventListener('input', e => {
            let val = e.target.value;
            // 驻砖专 专拽 住驻专 1-9
            if(!/^[1-9]$/.test(val)) {
              e.target.value = '';
              updateBoardValue(r, c, 0);
              checkErrors();
              return;
            }
            updateBoardValue(r, c, parseInt(val));
            checkErrors();
            checkCompletion();
          });
          td.appendChild(input);
        }
        tr.appendChild(td);
      }
      boardElem.appendChild(tr);
    }
  }

  // 注 注专 注专 
  function updateBoardValue(row, col, val) {
    currentBoard[row][col] = val;
  }

  // 拽 砖 砖转 
  function checkErrors() {
    clearErrors();
    let errors = false;

    // 驻拽爪 拽 驻转 砖专, 注, 拽
    function hasDuplicates(arr) {
      const seen = new Set();
      for(const num of arr){
        if(num === 0) continue;
        if(seen.has(num)) return true;
        seen.add(num);
      }
      return false;
    }

    // 住 砖转 转
    for(let r=0; r<9; r++) {
      for(let c=0; c<9; c++) {
        const val = currentBoard[r][c];
        if(val === 0) continue;

        // 砖专
        let rowVals = currentBoard[r];
        if(hasDuplicates(rowVals)) {
          markErrorInRow(r, val);
          errors = true;
        }

        // 注
        let colVals = [];
        for(let rr=0; rr<9; rr++) colVals.push(currentBoard[rr][c]);
        if(hasDuplicates(colVals)) {
          markErrorInCol(c, val);
          errors = true;
        }

        // 拽 3x3
        const startRow = Math.floor(r/3)*3;
        const startCol = Math.floor(c/3)*3;
        let blockVals = [];
        for(let rr=0; rr<3; rr++) {
          for(let cc=0; cc<3; cc++) {
            blockVals.push(currentBoard[startRow+rr][startCol+cc]);
          }
        }
        if(hasDuplicates(blockVals)) {
          markErrorInBlock(startRow, startCol, val);
          errors = true;
        }
      }
    }
    return errors;
  }

  // 拽 砖转
  function clearErrors() {
    boardElem.querySelectorAll('td.error').forEach(td => td.classList.remove('error'));
  }

  // 住 砖 砖专
  function markErrorInRow(row, val) {
    for(let c=0;c<9;c++) {
      if(currentBoard[row][c] === val) {
        markCellError(row, c);
      }
    }
  }
  // 住 砖 注
  function markErrorInCol(col, val) {
    for(let r=0;r<9;r++) {
      if(currentBoard[r][col] === val) {
        markCellError(r, col);
      }
    }
  }
  // 住 砖 拽
  function markErrorInBlock(startRow, startCol, val) {
    for(let r=0;r<3;r++) {
      for(let c=0;c<3;c++) {
        if(currentBoard[startRow+r][startCol+c] === val) {
          markCellError(startRow+r, startCol+c);
        }
      }
    }
  }
  // 住 转 砖
  function markCellError(row, col) {
    const rowEl = boardElem.children[row];
    if(!rowEl) return;
    const cell = rowEl.children[col];
    if(cell) cell.classList.add('error');
  }

  // 拽  砖拽 砖 
  function checkCompletion() {
    if(checkErrors()) {
      message.textContent = '';
      return false;
    }
    for(let r=0;r<9;r++){
      for(let c=0;c<9;c++){
        if(currentBoard[r][c] === 0) {
          message.textContent = '';
          return false;
        }
      }
    }
    message.textContent = " ! 砖转 转 住拽 ";
    stopTimer();
    return true;
  }

  // 专
  function startTimer() {
    if(timerRunning) return;
    timerRunning = true;
    timerToggle.setAttribute('aria-pressed', 'true');
    timerToggle.textContent = ' 专';
    timer = setInterval(() => {
      timerSeconds++;
      const mins = Math.floor(timerSeconds / 60).toString().padStart(2,'0');
      const secs = (timerSeconds % 60).toString().padStart(2,'0');
      timerDisplay.textContent = `${mins}:${secs}`;
    }, 1000);
  }
  function stopTimer() {
    timerRunning = false;
    timerToggle.setAttribute('aria-pressed', 'false');
    timerToggle.textContent = '驻注 专';
    clearInterval(timer);
    timer = null;
  }
  function resetTimer() {
    stopTimer();
    timerSeconds = 0;
    timerDisplay.textContent = '00:00';
  }

  // 爪专转 砖拽 砖 驻 专转 拽砖
  function newGame() {
    resetTimer();
    message.textContent = '';
    let board;
    switch(difficultySelect.value) {