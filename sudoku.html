<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>סודוקו מתקדם</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #222;
  color: white;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: flex-start;
}
.container {
  max-width: 800px;
  padding: 20px;
}
h1, h2 {
  text-align: center;
}
.hidden { display: none; }
button {
  background: #4CAF50;
  border: none;
  padding: 10px 20px;
  margin: 5px;
  color: white;
  font-size: 16px;
  cursor: pointer;
  border-radius: 8px;
}
button:hover { background: #45a049; }
select {
  padding: 5px;
  font-size: 16px;
  margin: 10px;
}
.board {
  display: grid;
  grid-template-columns: repeat(9, 40px);
  grid-template-rows: repeat(9, 40px);
  gap: 2px;
  margin: 20px auto;
}
.cell {
  background: white;
  color: black;
  text-align: center;
  font-size: 18px;
  border: 1px solid #999;
}
.cell[readonly] {
  background: #eee;
}
.error {
  background: #ffcccc !important;
}
.stats {
  display: flex;
  justify-content: space-between;
  margin: 10px 0;
}
</style>
</head>
<body>
<div class="container">
  <!-- מסך הבית -->
  <div id="home-screen">
    <h1>ברוכים הבאים לסודוקו</h1>
    <label for="difficulty">בחר רמת קושי:</label>
    <select id="difficulty">
      <option value="easy">קל</option>
      <option value="medium">בינוני</option>
      <option value="hard">קשה</option>
    </select>
    <br>
    <button id="start-btn">התחל משחק</button>
  </div>

  <!-- מסך המשחק -->
  <div id="game-screen" class="hidden">
    <div class="stats">
      <div>⏱ זמן: <span id="timer">0:00</span></div>
      <div>⭐ ניקוד: <span id="score">0</span></div>
    </div>
    <div class="board" id="sudoku-board"></div>
    <div style="text-align:center;">
      <button id="check-btn">בדוק</button>
      <button id="hint-btn">רמז</button>
      <button id="home-btn">חזור למסך הבית</button>
    </div>
  </div>
</div>

<script>
let timerInterval, time = 0, score = 0;
let solution = [];
let currentDifficulty = 'easy';

document.getElementById('start-btn').addEventListener('click', startGame);
document.getElementById('home-btn').addEventListener('click', () => {
  window.location.href = "https://shalev1912.github.io/chat-gpt/home.html";
});
document.getElementById('check-btn').addEventListener('click', checkBoard);
document.getElementById('hint-btn').addEventListener('click', giveHint);

function startGame() {
  currentDifficulty = document.getElementById('difficulty').value;
  document.getElementById('home-screen').classList.add('hidden');
  document.getElementById('game-screen').classList.remove('hidden');
  time = 0;
  score = 0;
  updateStats();
  startTimer();
  generateBoard(currentDifficulty);
}

function startTimer() {
  clearInterval(timerInterval);
  timerInterval = setInterval(() => {
    time++;
    updateStats();
  }, 1000);
}

function updateStats() {
  document.getElementById('timer').textContent = formatTime(time);
  document.getElementById('score').textContent = score;
}

function formatTime(sec) {
  const m = Math.floor(sec / 60);
  const s = sec % 60;
  return `${m}:${s.toString().padStart(2,'0')}`;
}

function generateBoard(difficulty) {
  const boardEl = document.getElementById('sudoku-board');
  boardEl.innerHTML = '';
  const puzzles = {
    easy:   '53..7....6..195....98....6.8...6...34..8.3..17...2...6.6....28....419..5....8..79',
    medium: '6..8745..8..1..6...9....8.5.4..9..7..8.....5..7..2..3.9.2....4...5..9..3..8412..6',
    hard:   '.....6....59.....82....8....8.45........3........6..3.9..5.....8.2.3.....1.....4.'
  };
  const puzzle = puzzles[difficulty].split('');
  solution = solveSudoku([...puzzle]);
  for (let i=0; i<81; i++) {
    const input = document.createElement('input');
    input.maxLength = 1;
    input.className = 'cell';
    if (puzzle[i] !== '.') {
      input.value = puzzle[i];
      input.readOnly = true;
    }
    input.addEventListener('input', () => validateCell(input, i));
    boardEl.appendChild(input);
  }
}

function validateCell(input, index) {
  input.classList.remove('error');
  const val = input.value;
  if (val && val !== solution[index]) {
    input.classList.add('error');
  } else if (val && val === solution[index]) {
    score += 10;
    updateStats();
  }
}

function checkBoard() {
  const cells = document.querySelectorAll('.cell');
  let correct = true;
  cells.forEach((cell, i) => {
    if (cell.value != solution[i]) {
      correct = false;
      cell.classList.add('error');
    } else {
      cell.classList.remove('error');
    }
  });
  if (correct) {
    alert('כל הכבוד! פתרת את הסודוקו!');
    score += 100;
    updateStats();
  }
}

function giveHint() {
  const cells = document.querySelectorAll('.cell');
  for (let i=0; i<81; i++) {
    if (!cells[i].value) {
      cells[i].value = solution[i];
      score -= 5;
      updateStats();
      break;
    }
  }
}

// פתרון סודוקו (Backtracking)
function solveSudoku(board) {
  const findEmpty = () => {
    for (let i = 0; i < 81; i++) if (board[i] === '.') return i;
    return null;
  };
  const isValid = (num, pos) => {
    const row = Math.floor(pos / 9);
    const col = pos % 9;
    for (let i = 0; i < 9; i++) {
      if (board[row * 9 + i] == num) return false;
      if (board[i * 9 + col] == num) return false;
    }
    const startRow = Math.floor(row / 3) * 3;
    const startCol = Math.floor(col / 3) * 3;
    for (let r = startRow; r < startRow + 3; r++) {
      for (let c = startCol; c < startCol + 3; c++) {
        if (board[r * 9 + c] == num) return false;
      }
    }
    return true;
  };
  const solve = () => {
    const emptyPos = findEmpty();
    if (emptyPos === null) return true;
    for (let num = 1; num <= 9; num++) {
      if (isValid(num.toString(), emptyPos)) {
        board[emptyPos] = num.toString();
        if (solve()) return true;
        board[emptyPos] = '.';
      }
    }
    return false;
  };
  solve();
  return board;
}
</script>
</body>
</html>
